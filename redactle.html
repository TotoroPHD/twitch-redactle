<html>

<head>
  <title>Redactle Maison</title>
  <meta charset="utf-8">
  <script src="https://cdn.jsdelivr.net/npm/comfy.js@latest/dist/comfy.min.js"></script>
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="style.css">
  <script src="config.js"></script>
  <style>

  </style>
</head>

<body>
  <div class="w3-cell-row">

    <div class="w3-container w3-twothird w3-black " id="tbf">
      <p>Ici le texte Ã  trouver</p>
    </div>

    <div class="w3-container w3-third w3-gray" id="words">
      <table class="w3-table w3-striped">
        <tr>
          <th>Pseudo</th>
          <th>Proposition</th>
          <th>Occurences</th>
        </tr>
      </table>
    </div>

  </div>
</body>

<script>
  var begin = "<table class=\"w3-table w3-striped\"><tr><th>Pseudo</th><th>Proposition</th><th>Occurences</th></tr>"
  var propositions = ""
  var end = "</table>"

  var computedtext = computeText(texte)

  ComfyJS.onChat = (user, message, flags, self, extra) => {

    if (!message.includes(" ") && (message.length <= 26)) {

      var allOccurences = document.getElementsByClassName(message);
      for (var i = 0; i < allOccurences.length; i++) {
        allOccurences[i].classList.remove("notfound");
      }

      propositions = "<tr>" + "<td>" + user + "</td>" + "<td>" + message + "</td>" + "<td>" + allOccurences.length + "</td>" + "</tr>" + propositions
      document.getElementById("words").innerHTML = begin + propositions + end

      if (!document.getElementById("tbf").innerHTML.split('</h1>')[0].includes("notfound")) {
        var allOccurences = document.getElementsByClassName("thisisaword");
        for (var i = 0; i < allOccurences.length; i++) {
          allOccurences[i].classList.remove("notfound");
        }
      }
    }
  }

  document.getElementById("tbf").innerHTML = computedtext;

  function computeText(texte) {
    var computedtext = ""
    var lines = texte.split('\n')
    lines.shift();

    for (var i = 0; i < lines.length; i++) {
      var words = lines[i].split(" ");
      var curline = "";
      for (var j = 0; j < words.length; j++) {
        words[j] = "<span class=\"notfound thisisaword " + words[j] + "\">" + words[j] + "</span>"
        curline += words[j] + " ";
      }

      lines[i] = curline;

      if (i == 0) {
        lines[i] = "<h1>" + lines[i] + "</h1>"
      }
      else {
        lines[i] = "<p>" + lines[i] + "</p>"
      }

      computedtext += lines[i];
    }


    return computedtext
  }

  ComfyJS.Init(channel);
</script>

</html>